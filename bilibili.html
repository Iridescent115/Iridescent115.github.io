<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilibili é‡ç‚¹UPä¸»å®æ—¶çœ‹æ¿</title>
    <style>
        :root {
            --primary-color: #FB7299;
            --secondary-color: #00AEEC;
            --bg-color: #f1f2f3;
            --card-bg: #ffffff;
            --text-main: #18191c;
            --text-secondary: #9499a0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: var(--text-main);
            margin-bottom: 40px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h1 span {
            color: var(--primary-color);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            width: 100%;
            max-width: 1200px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 30px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            border-top: 4px solid transparent;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
            border-top-color: var(--primary-color);
        }

        /* å¤´åƒæ ·å¼ */
        .avatar-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            position: relative;
        }

        .avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            object-fit: cover;
            background-color: #f0f0f0;
            transition: transform 0.3s;
        }
        
        .card:hover .avatar {
            transform: scale(1.05);
            border-color: var(--primary-color);
        }

        .up-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .up-uid {
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: #f6f7f8;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 20px;
        }

        .count {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            line-height: 1.2;
            font-variant-numeric: tabular-nums;
            letter-spacing: -1px;
            margin-bottom: 5px;
        }

        .label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .footer-status {
            margin-top: 50px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-align: center;
            line-height: 1.6;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-pulse {
            animation: pulse 1.5s infinite;
            color: #ccc;
        }
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        /* è§†é¢‘å¡ç‰‡æ ·å¼ */
        .video-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
            text-align: left;
        }

        .video-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .video-card-inner {
            display: flex;
            flex-direction: column;
            gap: 8px;
            text-decoration: none;
            color: inherit;
            transition: opacity 0.2s;
        }
        
        .video-card-inner:hover {
            opacity: 0.8;
        }

        .video-cover-box {
            position: relative;
            width: 100%;
            padding-top: 62.5%; /* 16:10 */
            border-radius: 6px;
            overflow: hidden;
            background: #e7e7e7;
        }

        .video-cover-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-duration {
            position: absolute;
            bottom: 6px;
            right: 6px;
            background: rgba(0,0,0,0.65);
            color: #fff;
            font-size: 11px;
            padding: 1px 4px;
            border-radius: 2px;
        }

        .video-title {
            font-size: 0.9rem;
            line-height: 1.4;
            color: var(--text-main);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 2.8em;
        }

        .video-stats {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .video-placeholder {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 10px 0;
        }

        /* è¿”å›ä¸»é¡µæŒ‰é’® */
        .home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 44px;
            height: 44px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-decoration: none;
            color: var(--text-secondary);
            transition: all 0.3s;
            z-index: 100;
        }
        .home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            color: var(--primary-color);
        }
        .home-btn svg {
            fill: currentColor;
            width: 24px;
            height: 24px;
        }

    </style>
</head>
<body>
    <a href="index.html" class="home-btn" title="è¿”å›ä¸»é¡µ">
        <svg viewBox="0 0 24 24">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
    </a>

    <h1>ğŸ“Š Bilibili <span>ç²‰ä¸å®æ—¶è¿½è¸ª</span></h1>

    <div class="grid-container" id="cards-area">
        <!-- JS å°†åœ¨è¿™é‡Œç”Ÿæˆå¡ç‰‡ -->
    </div>

    <div class="footer-status">
        æœ€åæ›´æ–°: <span id="last-update-time">--:--:--</span><br>
        æ•°æ®æ¥æº: Bilibili API (via CodeTabs Proxy)
    </div>

    <script>
        // UP ä¸»åˆ—è¡¨
        const upList = [
            { name: "éº»è–¯æ³¢æ¯”å‘€", uid: 703186600 },
            { name: "ä¸–ç•Œè§é—»å½•", uid: 316627722 },
            { name: "ç‡•ä¸‰å˜¤å˜¤å˜¤", uid: 430426421 },
            { name: "å°Linè¯´", uid: 520819684 }
        ];

        const container = document.getElementById('cards-area');
        const timeDisplay = document.getElementById('last-update-time');

        // 1. åˆå§‹åŒ–ç•Œé¢ (åˆ†ç¦»æ¸²æŸ“å’Œæ•°æ®åŠ è½½)
        async function init() {
            // ç¬¬ä¸€æ­¥ï¼šç«‹å³ç”Ÿæˆæ‰€æœ‰å¡ç‰‡æ¡†æ¶
            renderCards();

            // ç¬¬äºŒæ­¥ï¼šåŒè½¨å¹¶è¡ŒåŠ è½½æ•°æ®
            
            // è½¨é“Aï¼šå†…å®¹æ•°æ® (å¤´åƒã€è§†é¢‘) - ä½¿ç”¨è¾ƒå¿«ä»£ç†
            loadContentQueue();

            // è½¨é“Bï¼šç»Ÿè®¡æ•°æ® (ç²‰ä¸æ•°) - ä½¿ç”¨è¾ƒæ…¢ä»£ç†ï¼Œä¸¥æ ¼æ§åˆ¶é¢‘ç‡
            loadStatsQueue();

            // ä¹‹åæ¯ 10 ç§’åˆ·æ–°ä¸€æ¬¡ç²‰ä¸æ•°
            setInterval(loadStatsQueue, 10000);
        }

        // æ¸²æŸ“å¡ç‰‡ DOM
        function renderCards() {
            container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
            for (const up of upList) {
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${up.uid}`;
                
                // ç‚¹å‡»å¡ç‰‡è·³è½¬åˆ° B ç«™ä¸ªäººä¸»é¡µ
                card.onclick = () => window.open(`https://space.bilibili.com/${up.uid}`, '_blank');
                
                // é»˜è®¤æ˜¾ç¤ºä¸€ä¸ªç°è‰²çš„å ä½å›¾
                // referrerpolicy="no-referrer" æ˜¯å…³é”®ï¼Œå¦åˆ™ B ç«™å›¾ç‰‡ä¼šæŠ¥ 403 é”™è¯¯
                card.innerHTML = `
                    <div class="avatar-container">
                        <img src="https://i0.hdslb.com/bfs/face/member/noface.jpg" 
                             class="avatar" 
                             id="avatar-${up.uid}" 
                             alt="${up.name}"
                             referrerpolicy="no-referrer"
                             onerror="this.src='https://i0.hdslb.com/bfs/face/member/noface.jpg'">
                    </div>
                    <div class="up-name">${up.name}</div>
                    <div class="up-uid">UID: ${up.uid}</div>
                    <div>
                        <div class="count" id="count-${up.uid}"><span class="loading-pulse">---</span></div>
                        <div class="label">ç²‰ä¸æ•°</div>
                    </div>
                    
                    <!-- æœ€æ–°è§†é¢‘åŒºåŸŸ -->
                    <div class="video-section" id="video-section-${up.uid}">
                        <div class="video-label">æœ€æ–°æŠ•ç¨¿</div>
                        <div class="video-placeholder" id="vid-placeholder-${up.uid}">æ­£åœ¨è·å–æœ€æ–°è§†é¢‘...</div>
                        <div class="video-card-inner" id="video-link-${up.uid}" style="display: none;">
                            <div class="video-cover-box">
                                <img class="video-cover-img" id="vid-img-${up.uid}" referrerpolicy="no-referrer">
                                <div class="video-duration" id="vid-dur-${up.uid}"></div>
                            </div>
                            <div class="video-title" id="vid-title-${up.uid}"></div>
                            <div class="video-stats" id="vid-stat-${up.uid}"></div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            }
        }

        // é˜Ÿåˆ—Aï¼šåŠ è½½å¤´åƒå’Œè§†é¢‘ (å¿«ä»£ç†)
        async function loadContentQueue() {
            for (const up of upList) {
                fetchProfile(up.uid);
                fetchLatestVideo(up.uid);
                // é—´éš”å¢åŠ åˆ° 1000msï¼Œå› ä¸ºè§†é¢‘æ”¹ç”¨äº† codetabsï¼Œéœ€è¦é˜²æ­¢è¯·æ±‚è¿‡å¿«è¢«å°
                await new Promise(r => setTimeout(r, 1000));
            }
        }

        // é˜Ÿåˆ—Bï¼šåŠ è½½ç²‰ä¸æ•° (æ…¢ä»£ç†)
        async function loadStatsQueue() {
            const now = new Date();
            if(timeDisplay) timeDisplay.textContent = now.toLocaleTimeString();

            for (const up of upList) {
                const countEl = document.getElementById(`count-${up.uid}`);
                const num = await fetchFollowerCount(up.uid);

                if (num !== null) {
                    countEl.textContent = num.toLocaleString();
                    countEl.style.color = '#FB7299'; 
                } else {
                    if(countEl.innerText.includes('---')) {
                         countEl.textContent = "Error";
                         countEl.style.color = "#999";
                    }
                }
                // é—´éš”é•¿ä¸€ç‚¹ (1.5ç§’)ï¼Œä¿æŠ¤ codetabs ä»£ç†ä¸è¢«å°
                await new Promise(r => setTimeout(r, 1500));
            }
        }

        // 2. è·å–å¤´åƒ (ä½¿ç”¨ card æ¥å£)
        async function fetchProfile(uid) {
            const url = `https://api.bilibili.com/x/web-interface/card?mid=${uid}`;
            // æ”¹ç”¨ allorigins (è¾ƒå¿«)
            const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;

            try {
                const res = await fetch(proxy);
                const json = await res.json();
                
                if (json && json.data && json.data.card) {
                    // ç¡®ä¿ä½¿ç”¨ httpsï¼Œé¿å…æ··åˆå†…å®¹è­¦å‘Š
                    const avatarUrl = json.data.card.face.replace('http:', 'https:');
                    // æ›´æ–°å›¾ç‰‡ src
                    const imgEl = document.getElementById(`avatar-${uid}`);
                    if (imgEl) imgEl.src = avatarUrl;
                }
            } catch (e) {
                console.error(`å¤´åƒè·å–å¤±è´¥ UID:${uid}`, e);
            }
        }

        // æ–°å¢ï¼šè·å–æœ€æ–°è§†é¢‘
        async function fetchLatestVideo(uid) {
            // Bç«™ä¸ªäººç©ºé—´è§†é¢‘æœç´¢æ¥å£
            // å¢åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
            const url = `https://api.bilibili.com/x/space/arc/search?mid=${uid}&ps=1&pn=1&t=${Date.now()}`;
            // æ”¹å› codetabs (æ›´ç¨³å®š)ï¼Œallorigins å¯¹æœç´¢æ¥å£ç»å¸¸è¶…æ—¶
            const proxy = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;

            try {
                // è®¾ç½® 5 ç§’è¶…æ—¶ï¼Œé˜²æ­¢ä¸€ç›´æ˜¾ç¤ºâ€œæ­£åœ¨è·å–...â€
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const res = await fetch(proxy, { signal: controller.signal });
                clearTimeout(timeoutId); // æ¸…é™¤è¶…æ—¶å®šæ—¶å™¨
                
                const json = await res.json();

                if (json.code === 0 && json.data.list.vlist.length > 0) {
                    const v = json.data.list.vlist[0];
                    
                    // æ•°æ®å¤„ç†
                    const title = v.title;
                    const pic = v.pic.replace('http:', 'https:');
                    const length = v.length;
                    const play = v.play > 10000 ? (v.play/10000).toFixed(1) + 'ä¸‡' : v.play;
                    const bvid = v.bvid;
                    
                    // DOM æ›´æ–°
                    const link = document.getElementById(`video-link-${uid}`);
                    const placeholder = document.getElementById(`vid-placeholder-${uid}`);
                    const img = document.getElementById(`vid-img-${uid}`);
                    const dur = document.getElementById(`vid-dur-${uid}`);
                    const tit = document.getElementById(`vid-title-${uid}`);
                    const stat = document.getElementById(`vid-stat-${uid}`);

                    if (link) {
                        link.style.display = 'flex';
                        if (placeholder) placeholder.style.display = 'none';
                        
                        img.src = pic;
                        dur.textContent = length;
                        tit.textContent = title;
                        stat.innerHTML = `<span>â–¶ ${play}</span>`;
                        
                        // ç‚¹å‡»äº‹ä»¶ï¼šé˜»æ­¢å†’æ³¡ï¼Œæ‰“å¼€è§†é¢‘
                        link.onclick = (e) => {
                            e.stopPropagation();
                            window.open(`https://www.bilibili.com/video/${bvid}`, '_blank');
                        };
                    }
                }
            } catch (e) {
                // åŒºåˆ†æ˜¯è¶…æ—¶é”™è¯¯è¿˜æ˜¯å…¶ä»–é”™è¯¯
                const errorMsg = e.name === 'AbortError' ? 'è¯·æ±‚è¶…æ—¶' : 'åŠ è½½å¤±è´¥';
                console.error(`è§†é¢‘è·å–å¼‚å¸¸ UID:${uid}`, e);
                
                const placeholder = document.getElementById(`vid-placeholder-${uid}`);
                if (placeholder) placeholder.textContent = errorMsg;
            }
        }

        // 3. è·å–ç²‰ä¸æ•° (ä½¿ç”¨ stat æ¥å£ï¼Œè½»é‡çº§)
        async function fetchFollowerCount(uid) {
            const url = `https://api.bilibili.com/x/relation/stat?vmid=${uid}`;
            // ä¿æŒä½¿ç”¨ codetabs (è¾ƒæ…¢ä½†ç¨³å®š)
            const proxy = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;

            try {
                const res = await fetch(proxy);
                const json = await res.json();
                if (json && json.data) {
                    return json.data.follower;
                }
                return null;
            } catch (e) {
                console.error(`æ•°æ®è·å–å¤±è´¥ UID:${uid}`, e);
                return null;
            }
        }

        init();
    </script>
</body>
</html>